---
title: Attendance Note
layout: app.njk
permalink: /app/attendance/index.html
---

<h1 class="mb-4">{{ title }}</h1>

<form id="attForm" class="row g-3" novalidate>
  <input type="hidden" name="id" id="note_id" />

  <div class="col-md-6">
    <label class="form-label">Client First Name *</label>
    <input class="form-control" name="client_first_name" required>
  </div>
  <div class="col-md-6">
    <label class="form-label">Client Last Name *</label>
    <input class="form-control" name="client_last_name" required>
  </div>

  <div class="col-md-6">
    <label class="form-label">Court Date *</label>
    <input type="date" class="form-control" name="court_date" required required>
  </div>
  <div class="col-md-6">
  <label class="form-label">Next Steps Date (optional)</label>
  <input type="date" class="form-control" name="next_steps_date">
  </div>

  <div class="col-md-6">
    <label class="form-label">Court</label>
    <input class="form-control" name="court_name" list="dl_courts" placeholder="Type to search courts">
  </div>
  <div class="col-md-6">
    <label class="form-label">Law Firm</label>
    <input class="form-control" name="law_firm" list="dl_firms" placeholder="Type to search law firms">
  </div>

  <div class="col-md-6">
    <label class="form-label">Hearing Type</label>
    <input class="form-control" name="hearing_type" list="dl_hearing_types" placeholder="e.g. Sentencing, Youth Court, 1st Appearance">
  </div>

  <div class="col-md-6">
    <label class="form-label">Lawyer (instructing)</label>
    <input class="form-control" name="lawyer_name" list="dl_lawyers" placeholder="Type to search lawyers">
  </div>
  <div class="col-md-6">
    <label class="form-label">Coram (judge)</label>
    <input class="form-control" name="coram" list="dl_judges" placeholder="Type to search judges">
  </div>

  <div class="col-md-6">
    <label class="form-label">Contra (opponent)</label>
    <input class="form-control" name="contra" list="dl_contra" placeholder="e.g. Williams">
  </div>

  <div class="col-12">
    <label class="form-label">Advice</label>
    <textarea class="form-control" rows="6" name="advice_text" id="advice_text"></textarea>
    <div class="d-flex gap-2 mt-2">
      <button type="button" id="polishBtn" class="btn btn-outline-secondary">✨ Polish Text</button>
      <span id="adviceStatus" class="small text-muted align-self-center"></span>
    </div>
  </div>

  <div class="col-md-6">
    <label class="form-label">Outcome</label>
    <input class="form-control" name="outcome" placeholder="e.g. Adjourned for reports">
  </div>
  <div class="col-md-6">
    <label class="form-label">Remand</label>
    <input class="form-control" name="remand" placeholder="e.g. Bail continued">
  </div>

  <div class="col-12">
    <label class="form-label">Closing Paragraph</label>
    <div class="mb-2" style="max-width:420px">
      <select class="form-select form-select-sm" id="closing_select">
        <option value="">Choose a boilerplate…</option>
        {% for line in closing_boilerplates %}
          <option value="{{ line }}">{{ line }}</option>
        {% endfor %}
      </select>
    </div>
    <textarea class="form-control" rows="4" name="closing_text" id="closing_text" placeholder="Thank you for instructing me…"></textarea>
    <div class="form-text">Pick a boilerplate, then edit the text below.</div>
  </div>

  <div class="col-12">
    <label class="form-label">Expenses</label>
    <div id="expensesBox" class="border rounded p-2">
      <div class="d-flex justify-content-between align-items-center mb-2">
        <div class="text-muted small">Add expense line items (optional)</div>
        <button class="btn btn-sm btn-outline-primary" type="button" id="addExpenseBtn">+ Add expense</button>
      </div>
      <div id="expensesList"></div>
    </div>
  </div>

  <div class="col-md-4">
    <label class="form-label">Status</label>
    <select class="form-select" id="status_select">
      <option value="draft">Draft</option>
      <option value="final">Final</option>
      <option value="sent">Sent</option>
    </select>
    <div class="form-text">Draft is editable. Final/Sent are read-only; Sent can be archived.</div>
  </div>

  <div class="col-12 d-flex flex-wrap gap-2 align-items-center">
    <button class="btn btn-success" type="button" id="saveBtn">Save</button>
    <button class="btn btn-outline-danger" type="button" id="archiveBtn" disabled>Archive</button>
    <button class="btn btn-outline-dark" type="button" id="viewReportBtn" disabled>View report</button>
    <div class="form-check ms-2">
      <input class="form-check-input" type="checkbox" id="includeExpenses" />
      <label class="form-check-label" for="includeExpenses">Include expenses</label>
    </div>
    <div class="form-check ms-2">
      <input class="form-check-input" type="checkbox" id="includeMobile" />
      <label class="form-check-label" for="includeMobile">Include my personal mobile in footer</label>
    </div>
    <a href="/app/attendance/list/" class="btn btn-outline-secondary">All notes</a>
  </div>

  <div id="formStatus" class="small text-muted mt-2"></div>
</form>

<script src="/assets/js/attendance.js"></script>
<script>
  // Closing boilerplate -> input
  document.addEventListener('DOMContentLoaded', function(){
    var sel = document.getElementById('closing_select');
    var inp = document.getElementById('closing_text');
    if (sel && inp) sel.addEventListener('change', function(){ if(sel.value) inp.value = sel.value; });
  });

  // Expenses UI (lightweight, posts as flat fields exp_type[], exp_amount[])
  document.addEventListener('DOMContentLoaded', function(){
    var addBtn = document.getElementById('addExpenseBtn');
    var list = document.getElementById('expensesList');
    if(!addBtn || !list) return;
    function row(){
      var div = document.createElement('div');
      div.className = 'row g-2 align-items-end mb-2';
      div.innerHTML = `
        <div class="col-md-6">
          <label class="form-label small mb-1">Type</label>
          <input name="exp_type[]" class="form-control" list="expTypes" placeholder="e.g. Travel - Train">
        </div>
        <div class="col-md-4">
          <label class="form-label small mb-1">Amount (£)</label>
          <input name="exp_amount[]" class="form-control" type="number" step="0.01" min="0">
        </div>
        <div class="col-md-2">
          <button type="button" class="btn btn-outline-danger w-100 rm-exp">Remove</button>
        </div>`;
      return div;
    }
    addBtn.addEventListener('click', function(){ list.appendChild(row()); });
    list.addEventListener('click', function(e){ var b=e.target.closest('.rm-exp'); if(!b) return; b.closest('.row').remove(); });
    // seed one row
    list.appendChild(row());
  });
</script>
<datalist id="dl_judges"></datalist>
<datalist id="dl_lawyers"></datalist>
<datalist id="dl_firms"></datalist>
<datalist id="dl_courts"></datalist>
<datalist id="dl_contra"></datalist>
<datalist id="dl_hearing_types"></datalist>
<datalist id="expTypes">
  {% for t in expense_types %}<option value="{{ t }}"></option>{% endfor %}
  <option value="Miscellaneous"></option>
</datalist>
