---
title: Settings
layout: app.njk
permalink: /app/settings/index.html
---

<h1 class="mb-4">{{ title }}</h1>

<div class="card mb-3">
	<div class="card-header">Dropdown preferences (local)</div>
	<div class="card-body">
		<p class="text-muted small">
			For now these are stored on this device only (favourites/pinned). We’ll
			add Supabase‑synced directories next.
		</p>
		<div class="row g-2">
			<div class="col-md-6">
				<label class="form-label">Favourite Courts</label>
				<input
					id="fav_courts"
					class="form-control"
					placeholder="Comma‑separated, e.g. Wimbledon, Southwark"
				/>
			</div>
			<div class="col-md-6">
				<label class="form-label">Favourite Law Firms</label>
				<input
					id="fav_firms"
					class="form-control"
					placeholder="e.g. 23ES, Grabbit & Run"
				/>
			</div>
		</div>
		<button id="savePrefs" class="btn btn-primary mt-3">Save</button>
		<span id="prefsStatus" class="small text-muted ms-2"></span>
	</div>
</div>

<div class="card">
	<div class="card-header">Templates</div>
	<div class="card-body">
		<p class="mb-1">
			Chambers news snippet template (used when generating “Mark O’Connor was
			acquitted of …”)
		</p>
		<textarea
			id="chambers_tpl"
			class="form-control"
			rows="4"
			placeholder="Use {{client_last}}, {{court_name}}, {{court_date}}, {{result}}…"
		></textarea>
		<button id="saveTpl" class="btn btn-secondary mt-3">Save</button>
		<span id="tplStatus" class="small text-muted ms-2"></span>
	</div>
</div>

<script>
	document.addEventListener('DOMContentLoaded', () => {
		const favCourts = document.getElementById('fav_courts')
		const favFirms = document.getElementById('fav_firms')
		const tplArea = document.getElementById('chambers_tpl')

		// load from localStorage
		favCourts.value = localStorage.getItem('prefs_fav_courts') || ''
		favFirms.value = localStorage.getItem('prefs_fav_firms') || ''
		tplArea.value =
			localStorage.getItem('tpl_chambers_news') ||
			'Mark O’Connor secured a {{result}} in Rex v {{client_last}} at {{court_name}} on {{court_date}}.'

		document.getElementById('savePrefs').addEventListener('click', () => {
			localStorage.setItem('prefs_fav_courts', favCourts.value)
			localStorage.setItem('prefs_fav_firms', favFirms.value)
			document.getElementById('prefsStatus').textContent = 'Saved ✔'
			setTimeout(() => {
				document.getElementById('prefsStatus').textContent = ''
			}, 1200)
		})
		document.getElementById('saveTpl').addEventListener('click', () => {
			localStorage.setItem('tpl_chambers_news', tplArea.value)
			document.getElementById('tplStatus').textContent = 'Saved ✔'
			setTimeout(() => {
				document.getElementById('tplStatus').textContent = ''
			}, 1200)
		})
	})
</script>

<div class="card mt-3">
	<div class="card-header">Directory lists (Supabase)</div>
	<div class="card-body">
		<p class="text-muted small">
			Manage dropdown lists used in the Attendance form.
		</p>
		<div class="row g-3">
			<div class="col-md-6">
				<label class="form-label">Judges</label>
				<div class="input-group">
					<input
						id="dir_judges_val"
						class="form-control"
						placeholder="Add judge"
					/>
					<button class="btn btn-outline-primary" id="dir_judges_add">
						Add
					</button>
				</div>
				<ul id="dir_judges_list" class="list-group mt-2"></ul>
			</div>
			<div class="col-md-6">
				<label class="form-label">Lawyers</label>
				<div class="input-group">
					<input
						id="dir_lawyers_val"
						class="form-control"
						placeholder="Add lawyer"
					/>
					<button class="btn btn-outline-primary" id="dir_lawyers_add">
						Add
					</button>
				</div>
				<ul id="dir_lawyers_list" class="list-group mt-2"></ul>
			</div>
			<div class="col-md-6">
				<label class="form-label">Law Firms</label>
				<div class="input-group">
					<input
						id="dir_firms_val"
						class="form-control"
						placeholder="Add law firm"
					/>
					<button class="btn btn-outline-primary" id="dir_firms_add">
						Add
					</button>
				</div>
				<ul id="dir_firms_list" class="list-group mt-2"></ul>
			</div>
			<div class="col-md-6">
				<label class="form-label">Courtrooms</label>
				<div class="input-group">
					<input
						id="dir_courts_val"
						class="form-control"
						placeholder="Add courtroom"
					/>
					<button class="btn btn-outline-primary" id="dir_courts_add">
						Add
					</button>
				</div>
				<ul id="dir_courts_list" class="list-group mt-2"></ul>
			</div>
		</div>
	</div>
</div>

<script>
	async function dirFetch(type) {
		const r = await fetch(
			'/.netlify/functions/api-directory?type=' + encodeURIComponent(type)
		)
		const j = await r.json()
		if (!r.ok) throw new Error(j.error || 'failed')
		return j.items || []
	}
	async function dirAdd(type, value) {
		const r = await fetch(
			'/.netlify/functions/api-directory?type=' + encodeURIComponent(type),
			{
				method: 'POST',
				headers: { 'Content-Type': 'application/json' },
				body: JSON.stringify({ value }),
			}
		)
		const j = await r.json()
		if (!r.ok) throw new Error(j.error || 'failed')
		return true
	}
	async function dirDel(type, value) {
		const r = await fetch(
			'/.netlify/functions/api-directory?type=' + encodeURIComponent(type),
			{
				method: 'DELETE',
				headers: { 'Content-Type': 'application/json' },
				body: JSON.stringify({ value }),
			}
		)
		const j = await r.json()
		if (!r.ok) throw new Error(j.error || 'failed')
		return true
	}
	function renderList(type, listId) {
		dirFetch(type)
			.then((items) => {
				const ul = document.getElementById(listId)
				if (!ul) return
				ul.innerHTML = ''
				items.forEach((v) => {
					const li = document.createElement('li')
					li.className =
						'list-group-item d-flex justify-content-between align-items-center'
					li.innerHTML = `<span>${v}</span><button class="btn btn-sm btn-outline-danger">Delete</button>`
					li.querySelector('button').addEventListener('click', async () => {
						await dirDel(type, v)
						renderList(type, listId)
					})
					ul.appendChild(li)
				})
			})
			.catch(console.warn)
	}
	document.addEventListener('DOMContentLoaded', () => {
		renderList('judges', 'dir_judges_list')
		renderList('lawyers', 'dir_lawyers_list')
		renderList('law_firms', 'dir_firms_list')
		renderList('courtrooms', 'dir_courts_list')

		document
			.getElementById('dir_judges_add')
			.addEventListener('click', async () => {
				const v = document.getElementById('dir_judges_val').value.trim()
				if (!v) return
				await dirAdd('judges', v)
				document.getElementById('dir_judges_val').value = ''
				renderList('judges', 'dir_judges_list')
			})
		document
			.getElementById('dir_lawyers_add')
			.addEventListener('click', async () => {
				const v = document.getElementById('dir_lawyers_val').value.trim()
				if (!v) return
				await dirAdd('lawyers', v)
				document.getElementById('dir_lawyers_val').value = ''
				renderList('lawyers', 'dir_lawyers_list')
			})
		document
			.getElementById('dir_firms_add')
			.addEventListener('click', async () => {
				const v = document.getElementById('dir_firms_val').value.trim()
				if (!v) return
				await dirAdd('law_firms', v)
				document.getElementById('dir_firms_val').value = ''
				renderList('law_firms', 'dir_firms_list')
			})
		document
			.getElementById('dir_courts_add')
			.addEventListener('click', async () => {
				const v = document.getElementById('dir_courts_val').value.trim()
				if (!v) return
				await dirAdd('courtrooms', v)
				document.getElementById('dir_courts_val').value = ''
				renderList('courtrooms', 'dir_courts_list')
			})
	})
</script>

